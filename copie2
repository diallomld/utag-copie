import { Button, Card, Text } from '@rneui/base';
import React, { useEffect, useState } from 'react';
import { ActivityIndicator, ImageBackground, StyleSheet, View } from 'react-native';
import Colors from '../../constants/Colors';

import auth from "@react-native-firebase/auth";
import firestore from '@react-native-firebase/firestore';

function LivraisonsScreen({ navigation }) {

    const [livraisons, setLivraisons] = useState([])
    const [load, setLoad] = useState(null)
    let tab = []
    const getDelivey = (userId) => {

        setLoad(true)
        firestore()
            .collection("livraisons")
            .where("userId", "==", `${userId}`)
            .get()
            .then(data => {

                data.forEach((doc) => {
                    tab.push({
                        designation: doc.data().designation,
                        createdAt: doc.data().createdAt,
                        status: doc.data().status,
                        type: doc.data().type,
                    })
                })
                //console.error('tab ', tab)
                setLivraisons(tab)
                //console.error('liv ', livraisons)
                setLoad(false)
            }).catch(e => console.error(e))


    }

    useEffect(() => {
        getDelivey(auth().currentUser.uid)
    }, [])


    return (
        <View style={{ alignContent: 'center' }}>
            <ImageBackground
                source={require("../../assets/back-home.png")}
                style={{ width: '100%', height: '100%' }}>

                <View style={{ justifyContent: 'center', alignContent: 'center', alignItems: 'center', marginVertical: 100 }}>

                    <Button
                        title="Ajouter une livraison"
                        buttonStyle={{
                            backgroundColor: Colors.orange,
                            borderRadius: 20,
                        }}
                        containerStyle={{
                            width: 300,
                            marginHorizontal: 75,
                            marginVertical: 10,
                            justifyContent: 'center',
                            alignContent: 'center'
                        }}
                        titleStyle={styles.txtbutton}
                        onPress={() => { navigation.navigate("PosterLivraison") }}
                    />
                    {
                        load && <ActivityIndicator color={Colors.orange} size={'large'} />
                    }
                    {
                        livraisons.map((item, index) => {
                            return(
                            <Card containerStyle={{ width: 300, marginHorizontal: 75, borderRadius: 20 }}>
                                <View style={{ flexDirection: 'row', justifyContent: 'space-between' }}>
                                    <Text style={{ fontSize: 15 }}>{item.designation}</Text>
                                    <Text>
                                        {item.status}
                                    </Text>
                                    <Text>
                                        {item.createdAt.seconds}
                                    </Text>
                                </View>
                            </Card>
                            )
                        })
                    }

                </View>
            </ImageBackground>

        </View>
    );
}

export default LivraisonsScreen;


const styles = StyleSheet.create({
    txtbutton: {
        fontSize: 30,
        textAlign: "center",
        color: Colors.white
    },
})
